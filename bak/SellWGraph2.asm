
*=$2000
        BYTE    60,102,110,110,96,98,60,0
        BYTE    24,52,98,126,98,98,98,0
        BYTE    124,98,98,124,98,98,124,0
        BYTE    60,98,96,96,96,98,60,0
        BYTE    120,100,98,98,98,100,120,0
        BYTE    126,96,96,120,96,96,126,0
        BYTE    126,96,96,120,96,96,96,0
        BYTE    60,98,96,110,98,98,60,0
        BYTE    98,98,98,126,98,98,98,0
        BYTE    126,24,24,24,24,24,126,0
        BYTE    30,12,12,12,76,76,56,0
        BYTE    98,100,104,112,104,100,98,0
        BYTE    96,96,96,96,96,96,126,0
        BYTE    98,118,106,98,98,98,98,0
        BYTE    98,114,106,102,98,98,98,0
        BYTE    60,98,98,98,98,98,60,0
        BYTE    124,98,98,124,96,96,96,0
        BYTE    60,98,98,98,106,60,8,0
        BYTE    124,98,98,124,104,100,98,0
        BYTE    60,98,96,60,2,98,60,0
        BYTE    126,24,24,24,24,24,24,0
        BYTE    98,98,98,98,98,98,60,0
        BYTE    98,98,98,98,98,52,24,0
        BYTE    98,98,98,98,106,118,98,0
        BYTE    98,98,52,24,52,98,98,0
        BYTE    98,98,98,60,24,24,24,0
        BYTE    126,98,4,8,16,34,126,0
        BYTE    60,48,48,48,48,48,60,0
        BYTE    12,18,48,124,48,98,252,0
        BYTE    60,12,12,12,12,12,60,0
        BYTE    0,24,60,126,24,24,24,24
        BYTE    0,16,48,127,127,48,16,0
        BYTE    0,0,0,0,0,0,0,0
        BYTE    24,24,24,24,0,0,24,0
        BYTE    102,102,102,0,0,0,0,0
        BYTE    102,102,255,102,255,102,102,0
        BYTE    24,62,96,60,6,124,24,0
        BYTE    98,102,12,24,48,102,70,0
        BYTE    60,102,60,56,103,102,63,0
        BYTE    6,12,24,0,0,0,0,0
        BYTE    12,24,48,48,48,24,12,0
        BYTE    48,24,12,12,12,24,48,0
        BYTE    0,102,60,255,60,102,0,0
        BYTE    0,24,24,126,24,24,0,0
        BYTE    0,0,0,0,0,24,24,48
        BYTE    0,0,0,126,0,0,0,0
        BYTE    0,0,0,0,0,24,24,0
        BYTE    0,3,6,12,24,48,96,0
        BYTE    60,66,66,90,66,66,60,0
        BYTE    8,24,40,8,8,8,126,0
        BYTE    60,66,2,28,32,66,126,0
        BYTE    60,66,2,12,2,66,60,0
        BYTE    4,12,20,36,126,4,4,0
        BYTE    126,64,124,2,2,66,60,0
        BYTE    60,66,64,124,66,66,60,0
        BYTE    126,2,4,8,60,16,16,0
        BYTE    24,36,36,60,66,66,60,0
        BYTE    60,66,66,62,2,66,60,0
        BYTE    0,0,24,0,0,24,0,0
        BYTE    0,0,24,0,0,24,24,48
        BYTE    14,24,48,96,48,24,14,0
        BYTE    0,0,126,0,126,0,0,0
        BYTE    112,24,12,6,12,24,112,0
        BYTE    60,102,6,12,24,0,24,0
        BYTE    0,0,0,255,255,0,0,0
        BYTE    8,28,62,127,127,28,62,0
        BYTE    24,24,24,24,24,24,24,24
        BYTE    0,0,0,255,255,0,0,0
        BYTE    0,0,255,255,0,0,0,0
        BYTE    0,255,255,0,0,0,0,0
        BYTE    0,0,0,0,255,255,0,0
        BYTE    48,48,48,48,48,48,48,48
        BYTE    12,12,12,12,12,12,12,12
        BYTE    0,0,0,224,240,56,24,24
        BYTE    24,24,28,15,7,0,0,0
        BYTE    24,24,56,240,224,0,0,0
        BYTE    192,192,192,192,192,192,255,255
        BYTE    192,224,112,56,28,14,7,3
        BYTE    3,7,14,28,56,112,224,192
        BYTE    255,255,192,192,192,192,192,192
        BYTE    255,255,3,3,3,3,3,3
        BYTE    255,255,255,251,243,227,195,131
        BYTE    0,0,0,0,0,255,255,0
        BYTE    54,127,127,127,62,28,8,0
        BYTE    96,96,96,96,96,96,96,96
        BYTE    0,0,0,7,15,28,24,24
        BYTE    195,231,126,60,60,126,231,195
        BYTE    0,60,126,102,102,126,60,0
        BYTE    24,24,102,102,24,24,60,0
        BYTE    6,6,6,6,6,6,6,6
        BYTE    8,28,62,127,62,28,8,0
        BYTE    24,24,24,255,255,24,24,24
        BYTE    192,192,48,48,192,192,48,48
        BYTE    24,24,24,24,24,24,24,24
        BYTE    0,0,3,62,118,54,54,0
        BYTE    255,127,63,31,15,7,3,1
        BYTE    0,0,0,0,0,0,0,0
        BYTE    240,240,240,240,240,240,240,240
        BYTE    0,0,0,0,255,255,255,255
        BYTE    255,0,0,0,0,0,0,0
        BYTE    100,138,138,74,42,42,196,0
        BYTE    140,138,138,138,138,138,236,0
        BYTE    204,204,51,51,204,204,51,51
        BYTE    3,3,3,3,3,3,3,3
        BYTE    0,0,0,0,204,204,51,51
        BYTE    255,254,252,248,240,224,192,128
        BYTE    3,3,3,3,3,3,3,3
        BYTE    24,24,24,31,31,24,24,24
        BYTE    0,0,0,0,15,15,15,15
        BYTE    24,24,24,31,31,0,0,0
        BYTE    0,0,0,248,248,24,24,24
        BYTE    0,0,0,0,0,0,255,255
        BYTE    0,0,0,31,31,24,24,24
        BYTE    24,24,24,255,255,0,0,0
        BYTE    0,0,0,255,255,24,24,24
        BYTE    24,24,24,248,248,24,24,24
        BYTE    192,192,192,192,192,192,192,192
        BYTE    224,224,224,224,224,224,224,224
        BYTE    7,7,7,7,7,7,7,7
        BYTE    255,255,0,0,0,0,0,0
        BYTE    255,255,255,0,0,0,0,0
        BYTE    0,0,0,0,0,255,255,255
        BYTE    0,85,85,37,35,0,64,128
        BYTE    0,69,109,84,69,0,0,0
        BYTE    0,174,168,170,110,0,64,128
        BYTE    24,40,88,60,26,24,36,36
        BYTE    24,8,90,60,24,24,36,36
        BYTE    0,24,24,60,90,24,36,36
        BYTE    195,153,145,145,159,153,195,255
        BYTE    231,195,153,129,153,153,153,255
        BYTE    131,153,153,131,153,153,131,255
        BYTE    195,153,159,159,159,153,195,255
        BYTE    135,147,153,153,153,147,135,255
        BYTE    129,159,159,135,159,159,129,255
        BYTE    129,159,159,135,159,159,159,255
        BYTE    195,153,159,145,153,153,195,255
        BYTE    153,153,153,129,153,153,153,255
        BYTE    195,231,231,231,231,231,195,255
        BYTE    225,243,243,243,243,147,199,255
        BYTE    153,147,135,143,135,147,153,255
        BYTE    159,159,159,159,159,159,129,255
        BYTE    156,136,128,148,156,156,156,255
        BYTE    153,137,129,129,145,153,153,255
        BYTE    195,153,153,153,153,153,195,255
        BYTE    131,153,153,131,159,159,159,255
        BYTE    195,153,153,153,153,195,241,255
        BYTE    131,153,153,131,135,147,153,255
        BYTE    195,153,159,195,249,153,195,255
        BYTE    129,231,231,231,231,231,231,255
        BYTE    153,153,153,153,153,153,195,255
        BYTE    153,153,153,153,153,195,231,255
        BYTE    156,156,156,148,128,136,156,255
        BYTE    153,153,195,231,195,153,153,255
        BYTE    153,153,153,195,231,231,231,255
        BYTE    129,249,243,231,207,159,129,255
        BYTE    195,207,207,207,207,207,195,255
        BYTE    243,237,207,131,207,157,3,255
        BYTE    195,243,243,243,243,243,195,255
        BYTE    255,231,195,129,231,231,231,231
        BYTE    255,239,207,128,128,207,239,255
        BYTE    255,255,255,255,255,255,255,255
        BYTE    231,231,231,231,255,255,231,255
        BYTE    153,153,153,255,255,255,255,255
        BYTE    153,153,0,153,0,153,153,255
        BYTE    231,193,159,195,249,131,231,255
        BYTE    157,153,243,231,207,153,185,255
        BYTE    195,153,195,199,152,153,192,255
        BYTE    249,243,231,255,255,255,255,255
        BYTE    243,231,207,207,207,231,243,255
        BYTE    207,231,243,243,243,231,207,255
        BYTE    255,153,195,0,195,153,255,255
        BYTE    255,231,231,129,231,231,255,255
        BYTE    255,255,255,255,255,231,231,207
        BYTE    255,255,255,129,255,255,255,255
        BYTE    255,255,255,255,255,231,231,255
        BYTE    255,252,249,243,231,207,159,255
        BYTE    195,153,145,137,153,153,195,255
        BYTE    231,231,199,231,231,231,129,255
        BYTE    195,153,249,243,207,159,129,255
        BYTE    195,153,249,227,249,153,195,255
        BYTE    249,241,225,153,128,249,249,255
        BYTE    129,159,131,249,249,153,195,255
        BYTE    195,153,159,131,153,153,195,255
        BYTE    129,153,243,231,231,231,231,255
        BYTE    195,153,153,195,153,153,195,255
        BYTE    195,153,153,193,249,153,195,255
        BYTE    255,255,231,255,255,231,255,255
        BYTE    255,255,231,255,255,231,231,207
        BYTE    241,231,207,159,207,231,241,255
        BYTE    255,255,129,255,129,255,255,255
        BYTE    143,231,243,249,243,231,143,255
        BYTE    195,153,249,243,231,255,231,255
        BYTE    255,255,255,0,0,255,255,255
        BYTE    247,227,193,128,128,227,193,255
        BYTE    231,231,231,231,231,231,231,231
        BYTE    255,255,255,0,0,255,255,255
        BYTE    255,255,0,0,255,255,255,255
        BYTE    255,0,0,255,255,255,255,255
        BYTE    255,255,255,255,0,0,255,255
        BYTE    207,207,207,207,207,207,207,207
        BYTE    243,243,243,243,243,243,243,243
        BYTE    255,255,255,31,15,199,231,231
        BYTE    231,231,227,240,248,255,255,255
        BYTE    231,231,199,15,31,255,255,255
        BYTE    63,63,63,63,63,63,0,0
        BYTE    63,31,143,199,227,241,248,252
        BYTE    252,248,241,227,199,143,31,63
        BYTE    0,0,63,63,63,63,63,63
        BYTE    0,0,252,252,252,252,252,252
        BYTE    255,195,129,129,129,129,195,255
        BYTE    255,255,255,255,255,0,0,255
        BYTE    201,128,128,128,193,227,247,255
        BYTE    159,159,159,159,159,159,159,159
        BYTE    255,255,255,248,240,227,231,231
        BYTE    60,24,129,195,195,129,24,60
        BYTE    255,195,129,153,153,129,195,255
        BYTE    231,231,153,153,231,231,195,255
        BYTE    249,249,249,249,249,249,249,249
        BYTE    247,227,193,128,193,227,247,255
        BYTE    231,231,231,0,0,231,231,231
        BYTE    63,63,207,207,63,63,207,207
        BYTE    231,231,231,231,231,231,231,231
        BYTE    255,255,252,193,137,201,201,255
        BYTE    0,128,192,224,240,248,252,254
        BYTE    255,255,255,255,255,255,255,255
        BYTE    15,15,15,15,15,15,15,15
        BYTE    255,255,255,255,0,0,0,0
        BYTE    0,255,255,255,255,255,255,255
        BYTE    255,255,255,255,255,255,255,0
        BYTE    63,63,63,63,63,63,63,63
        BYTE    51,51,204,204,51,51,204,204
        BYTE    252,252,252,252,252,252,252,252
        BYTE    255,255,255,255,51,51,204,204
        BYTE    0,1,3,7,15,31,63,127
        BYTE    252,252,252,252,252,252,252,252
        BYTE    231,231,231,224,224,231,231,231
        BYTE    255,255,255,255,240,240,240,240
        BYTE    231,231,231,224,224,255,255,255
        BYTE    255,255,255,7,7,231,231,231
        BYTE    255,255,255,255,255,255,0,0
        BYTE    255,255,255,224,224,231,231,231
        BYTE    231,231,231,0,0,255,255,255
        BYTE    255,255,255,0,0,231,231,231
        BYTE    231,231,231,7,7,231,231,231
        BYTE    63,63,63,63,63,63,63,63
        BYTE    31,31,31,31,31,31,31,31
        BYTE    248,248,248,248,248,248,248,248
        BYTE    0,0,255,255,255,255,255,255
        BYTE    0,0,0,255,255,255,255,255
        BYTE    255,255,255,255,255,0,0,0
        BYTE    252,252,252,252,252,252,0,0
        BYTE    255,255,255,255,15,15,15,15
        BYTE    0,0,0,0,0,0,0,0
        BYTE    0,88,154,124,24,24,36,36
        BYTE    24,8,24,60,90,24,36,36
        BYTE    0,24,24,60,60,24,24,24





*=$3000
; Truck right
 BYTE 170,170,0
 BYTE 170,170,160
 BYTE 175,254,144
 BYTE 191,255,144
 BYTE 191,255,144
 BYTE 191,255,169
 BYTE 191,255,170
 BYTE 170,170,170
 BYTE 85,169,86
 BYTE 65,85,5
 BYTE 60,84,240
 BYTE 60,0,240
 BYTE 60,0,240
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; Truck right
 BYTE 0,0,0
 BYTE 170,170,0
 BYTE 170,170,160
 BYTE 175,254,144
 BYTE 191,255,144
 BYTE 191,255,144
 BYTE 191,255,169
 BYTE 191,255,170
 BYTE 170,170,170
 BYTE 85,169,86
 BYTE 125,85,245
 BYTE 60,84,240
 BYTE 60,0,240
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; Truck right 3
 BYTE 170,170,0
 BYTE 170,170,160
 BYTE 175,254,144
 BYTE 191,255,144
 BYTE 191,255,144
 BYTE 191,255,169
 BYTE 191,255,170
 BYTE 170,170,170
 BYTE 85,169,86
 BYTE 125,85,245
 BYTE 60,84,240
 BYTE 60,0,240
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; 3/4 Truck
 BYTE 0,0,170
 BYTE 0,2,170
 BYTE 0,10,170
 BYTE 0,42,170
 BYTE 0,170,138
 BYTE 2,170,10
 BYTE 10,168,10
 BYTE 42,160,10
 BYTE 42,160,43
 BYTE 21,224,175
 BYTE 21,226,144
 BYTE 42,170,64
 BYTE 170,169,0
 BYTE 170,164,0
 BYTE 105,128,0
 BYTE 170,192,0
 BYTE 243,192,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; Man
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,128,0
 BYTE 2,0,0
 BYTE 1,0,0
 BYTE 1,1,0
 BYTE 50,5,0
 BYTE 6,16,0
 BYTE 2,80,0
 BYTE 1,0,0
 BYTE 5,0,0
 BYTE 16,0,0
 BYTE 80,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; CrapBurger
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,15,192
 BYTE 0,63,240
 BYTE 0,255,248
 BYTE 0,255,172
 BYTE 3,250,252
 BYTE 2,175,240
 BYTE 3,255,0
 BYTE 0,240,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; Taco
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,41,128
 BYTE 0,175,224
 BYTE 1,186,168
 BYTE 10,234,152
 BYTE 11,170,168
 BYTE 11,154,168
 BYTE 11,170,104
 BYTE 10,170,168
 BYTE 2,170,160
 BYTE 0,154,0
 BYTE 0,160,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0

; HotDog
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,60
 BYTE 0,3,252
 BYTE 0,63,234
 BYTE 0,254,190
 BYTE 0,235,252
 BYTE 2,191,252
 BYTE 2,191,240
 BYTE 0,255,0
 BYTE 0,240,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0,0,0
 BYTE 0





; 10 SYS (26112)

*=$0801

        BYTE    $0E, $08, $0A, $00, $9E, $20, $28,  $32, $36, $31, $31, $32, $29, $00, $00, $00



;Set variables;
Speed           byte 5
BakeTimer       byte 10
TruckType       byte 1
Price           byte 4
PriceHi         byte 0
CashCount       byte 0
CashCountHi     byte 0
PassCount       byte 0
PassCountHi     byte 0
LineCount       byte 0
LineCountHi     byte 0
SaleCount       byte 0
SaleCountHi     byte 0
LeftCount       byte 0
LeftCountHi     byte 0
PopCount        byte 30
PopCountHi      byte 0
VisitCount      byte 0
VisitCountHi    byte 0
ManFrame        byte $7f
angryFrame      byte $7e
eatFrame        byte $7d
CookingCnt      byte 5
linepos         byte $1D,$1E,$1F,$20,$21,$22,$23,$24,$25
div_lo          byte 0
div_hi          byte 0

waitlbl         null 'in line 00000'
passlbl         null 'no thnx 00000'
gonelbl         null '  angry 00000'
soldlbl         null '   sold 00000'
poplbl          null 'pop          '
endday          null 'end of day'
total           null 'sold    price   total'

;Set Constants;
scnsrt          = #$0400
SPR_ROOT        = ($3000/64)
rand            = $d41b
leavchance      = #$e6
firstguy        = $051d

defm 16bitadd 
        clc
        lda /1          ;/1 is low bit for 16 bit number /2 is high bit for 16 bit number /3 is ammount to add up to 255
        adc /3
        sta /1
        bcc @go
        inc /2
        clc
@go            

        endm

defm 16bitsub 
        
        sec
        lda /1          ;/1 is low bit for 16 bit number /2 is high bit for 16 bit number /3 is ammount to subtract up to 255
        sbc /3
        sta /1
        bcs @go
        dec /2
        sec
@go            

        endm

defm conv2dec   ;http://www.melon64.com/forum/viewtopic.php?f=25&t=401&sid=0ae0df3cfc87b121fe84d14c9ef605b3&start=10
  LDY /2        ;2 is the high bite for a number (set to #0 if not used)
  LDX /1        ;1 is the low bite of a number 
  STX div_lo
  STY div_hi
  LDY #$04
@next
  JSR @div10
  ORA #$30
  STA /3,Y      ;3 is the screen location to load the text (5numbers)
  DEY
  BPL @next
  jmp @macend

@div10
  LDX #$11
  LDA #$00
  CLC
@loop
  ROL
  CMP #$0A
  BCC @skip
  SBC #$0A
  CLV
@skip
  ROL div_lo
  ROL div_hi
  DEX
  BNE @loop
  RTS
@macend
        endm

*=$6600
        LDA #$6F        ;This Part initalized noise channel for random
        LDY #$81        ;and lets us use lda $d41b to grab a random num
        LDX #$FF        ;between 0-255
        STA $D413 
        STY $D412 
        STX $D40E 
        STX $D40F 
        STX $D414 

        jsr $e544       ;clear screen
        lda #$18
        sta $d018       ;set char rom to $3800 and leave screen ram default
        lda #0              ;set border colour
        sta $D020
        lda #11         ;set background colour
        sta $D021
        lda #1          ;set global sprite colour 1
        sta $d025
        lda #0         ;set global sprite colour 2
        sta $d026
        lda #5
        sta $d027       ;storesprite1 colour
        lda #3
        sta $d028       ;storesprite2 colour
        lda #%00000011  
        sta $d015       ;turn on sprites
        sta $d01c       ;set sprite mode
        sta $d01b       ;set sprite behind text
        lda #%00000010  ;set sprite size
        sta $d017
        sta $d01d
        lda #SPR_ROOT+4         ;load sprite of vendor
        sta $07f8
        lda #40
        sta $d002
        asl 
        sta $d003
        lda #SPR_ROOT+3         ;load sprite of truck (they overlap to make a nicer sprite)
        sta $07f9
        lda #64
        sta $d000
        lda #86
        sta $d001
        
        ldx #0
        lda #1
colfil  sta $d800,x                     ;fill color ram white
        sta $d900,x
        sta $da00,x
        sta $dae8,x
        dex
        bne colfil
        ldx    #20
        lda #$60 
linestart 
        sta     firstguy,x              ;make sure line is spaces
        dex
        bne linestart
        ldx #0
write   lda passlbl,x                      ;adds words
        sta scnsrt+681,x
        lda waitlbl,x
        sta scnsrt+761,x
        lda soldlbl,x
        sta scnsrt+841,x
        lda gonelbl,x
        sta scnsrt+921,x
        lda poplbl,x
        sta scnsrt+20,x
        inx
        cpx #7
        bne write

        lda     Speed           
        sta     BakeTimer       ;init bake speed
                
newcust 
        lda #0              ;set border colour
        sta $D020
        lda VisitCountHi
        cmp PopCountHi
        bne cyclestart
        lda VisitCount
        cmp PopCount
        bne cyclestart
        jmp summary
cyclestart
        16bitadd VisitCount, VisitCountHi, #1
        conv2dec        PassCount,PassCountHi,$06B1     ;update pass count
        conv2dec        LineCount,LineCountHi,$0701     ;update inline count
        conv2dec        SaleCount,SaleCountHi,$0751     ;update sale count
        conv2dec        LeftCount,LeftCountHi,$07A1     ;update angry count
        conv2dec        VisitCount,VisitCountHi,$0422-10   ;update number of people
        conv2dec        PopCount,PopCountHi,$0422-20   ;update number of people
        
        ldx     #17             ;number of times to run
        lda     #00
        sta     $fb             ;set zero page for start location
        lda     #$07            ;set high bit for start location
        sta     $fc
        ldy     #$e3            ;set low bit for start location
        sec                     ;set Carry for some math later
walkby  txs                     ;save x for when jsr returns
        jsr     delay2          ;slow it down so we can see it
        tsx                     ;load x back into x
        lda     #%10000000      ;reverse char mask
        eor     ManFrame        ;flip bit 8 for ManFrame
        sta     ManFrame        ;save it back on ManFrame
        lda     #$60            ;load " " into acc
        sta     ($fb),y         ;load it at the bottom of screen
        tya                     ;transfer y to accumulator then
        sbc     #40             ;subtract 40 (one line)
        tay                     ;save acc in y
        bcc     nxtbl           ;if math cleared carry we need to move up one high bit
wlkrtn  lda     ManFrame        ;otherwise we are good to place next man frame
        sta     ($fb),y         ;at this screen location
        dex                     
        bne     walkby          ;next loop
        jmp     checkstop       
nxtbl   dec     $fc             ;decrease high bit for screen location
        sec
        jmp     wlkrtn

checkstop   
        lda     rand   ;do they stop?
        cmp     #$3f
        bcc     leave

lineup  lda     #9             ;set line max size
        cmp     LineCount       ;check if line full
        bcc     leave           ;if so leave
        inc     LineCount       ;if not inc linecount
        lda     #30            ;distance to start of line
        sbc     LineCount       ;less number of people in line
        tax                     ;set number of loops
        ldy     #30             ;set travel distance
linelp  txs                     ;save x for when jsr returns
        jsr     delay2          ;slow it down so we can see it
        tsx                     ;load x back into x
        lda     #%10000000      ;reverse char mask
        eor     ManFrame        ;flip bit 8 for ManFrame
        sta     ManFrame        ;save it back on ManFrame
        lda     #$60            ;load " " into acc
        sta     firstguy,y         ;store at line start +y
        lda     ManFrame        ;load Man Chr into acc
        dey
        sta     firstguy,y         ;store at line start +y
        dex
        bne     linelp
        
        jmp     sold2


        
leave   inc     PassCount
        ldx     #7             ;number of times to run
        lda     #00
        sta     $fb             ;set zero page for start location
        lda     #$05            ;set high bit for start location
        sta     $fc
        ldy     #$3B            ;set low bit for start location
        sec                     ;set Carry for some math later
leaving txs                     ;save x for when jsr returns
        jsr     delay2          ;slow it down so we can see it
        tsx                     ;load x back into x
        lda     #%10000000      ;reverse char mask
        eor     ManFrame        ;flip bit 8 for ManFrame
        sta     ManFrame        ;save it back on ManFrame
        lda     #$60            ;load " " into acc
        sta     ($fb),y         ;load it at the bottom of screen
        tya                     ;transfer y to accumulator then
        sbc     #40             ;subtract 40 (one line)
        tay                     ;save acc in y
        bcc     nxtll           ;if math cleared carry we need to move up one high bit
lvertn  lda     ManFrame        ;otherwise we are good to place next man frame
        sta     ($fb),y         ;at this screen location
        dex                     
        bne     leaving          ;next loop
        jsr     delay2
        lda     #$60
        sta     $0423
        jmp     sold2       
nxtll   dec     $fc             ;decrease high bit for screen location
        sec
        jmp     lvertn

gomad   jmp     angry        

sold2    ldx     #0
        lda     firstguy+1         ;grab character at line pos 1
        cmp     #$60            ;check if it's a space
        beq     gomad
        dec     BakeTimer
        bne     gomad
        inc     SaleCount
        dec     LineCount
        conv2dec        SaleCount,SaleCountHi,$0751     ;update sale count
        lda     #00
        sta     $fb             ;set zero page for start location
        lda     #$05            ;set high bit for start location
        sta     $fc
        lda     #00
        sta     $f9             ;set zero page for start location
        lda     #$d9            ;set high bit for start location
        sta     $fa
        ldy     #$1E            ;set low bit for start location
        clc                     ;clear Carry for some math later
        lda     eatFrame
        sta     ($fb),y
        lda     #5
        sta     ($f9),y
        lda     #$7A            ;this bit stores yum on screen
        sta     $04f7
        lda     #$7B
        sta     $04f8
        txs                     ;save x for when jsr returns
        ldx     #$50
        jsr     delayx          ;slow it down so we can see it
        lda     #1
        sta     ($f9),y
        tsx                     ;load x back into x
        lda     #$60            ;this bit clears yum on screen
        sta     $04f7
        sta     $04f8
sldexit txs                     ;save x for when jsr returns
        jsr     delay2          ;slow it down so we can see it
        tsx                     ;load x back into x
        lda     #%10000000      ;reverse char mask
        eor     eatFrame        ;flip bit 8 for eatFrame
        sta     eatFrame        ;save it back on eatFrame
        lda     #$60            ;load " " into acc
        sta     ($fb),y         ;load it at the start position
        tya                     ;transfer y to accumulator then
        adc     #38             ;subtract 39
        tay                     ;save acc in y
        bcs     inline           ;if math cleared carry we need to move up one high bit
sldrtn  lda     eatFrame        ;otherwise we are good to place next man frame
        sta     ($fb),y         ;at this screen location
        inx                     
        cpx     #6
        bne     sldexit          ;next loop
        lda     Speed           
        sta     BakeTimer       ;init bake speed
        jsr     delay2
        lda     #$60
        sta     $0608
        jmp     linefix     
inline  inc     $fc             ;decrease high bit for screen location
        clc
        jmp     sldrtn
        

linefix ldx     #1              ;reset x      here we are fixing the line of missing jerks 
        ldy     #0
        lda     #5
lnlp    lda     firstguy,x         ;grab character at line pos 1
        cmp     #96            ;check if it's a space
        beq     nxtdude
nxtln   inx     
        cmp     #11
        bne     lnlp
        jmp     goback
nxtdude lda     $051E,x         ;grab char in next spot
        cmp     #96            ;check if it's a space (two spaces mean no more blanks)
        beq     goback        ;if so do a new customer
        sta     firstguy,x        ;otherwise move one to new spot
        lda     #96            ;load " "
        sta     $051E,x        ;and replace copy
        jmp     nxtln
goback  jmp     newcust

angry   ldx     #4              ;reset x        here we are checking if they mad 
        ldy     #0
lvelp   lda     firstguy,x         ;grab character at line pos 1
        cmp     #96            ;check if it's a space
        beq     linefix   
        lda     rand
        cmp     #$3f
        bcc     gonedy
        inx     
        cpx     #10
        bne     lvelp
        jmp     linefix



gonedy  dec     LineCount       ;lower line count
        inc     LeftCount
        lda     #00
        sta     $fb             ;set zero page for start location
        lda     #$05            ;set high bit for start location
        sta     $fc
        lda     #00
        sta     $f9             ;set zero page for start location
        lda     #$d9            ;set high bit for start location
        sta     $fa
        ldy     linepos,x            ;set low bit for start location
        sec                     ;set Carry for some math later
        lda     angryFrame
        sta     ($fb),y
        lda     #%10000000      ;reverse char mask
        eor     angryFrame      ;flip bit 8 for angryman
        sta     angryFrame      ;save it back on angryman
        lda     #2
        sta     ($f9),y
        tya                     ;transfer y to accumulator then
        sbc     #39             ;subtract 39 (up and right one)
        tay
        bcc     decline           ;if math cleared carry we need to move up one high bit
gnrtn   lda     #124            ;otherwise we are good to place ug 
        sta     ($fb),y         ;at this screen location
                                ;animate angry man off screen
        txs
        ldx     #$7f
        jsr     delayx
        tsx
        lda     #$60            ;get rid of ug
        sta     ($fb),y         ;at this screen location

        ldy     linepos,x            ;set low bit for start location
        
        lda     #$05            ;set high bit for start location
        sta     $fc
        ldx     #7
        sec
gnrtn2  txs                     ;save x for when jsr returns
        jsr     delay2          ;slow it down so we can see it
        tsx                     ;load x back into x
        lda     #%10000000      ;reverse char mask
        eor     angryFrame        ;flip bit 8 for ManFrame
        sta     angryFrame        ;save it back on ManFrame
        lda     #$60            ;load " " into acc
        sta     ($fb),y         ;load it at the bottom of screen
        lda     #1
        sta     ($f9),y
        tya                     ;transfer y to accumulator then
        sbc     #40             ;subtract 40 (one line)
        tay                     ;save acc in y
        bcc     dcln2           ;if math cleared carry we need to move up one high bit
gnrtn3  lda     angryFrame        ;otherwise we are good to place next man frame
        sta     ($fb),y         ;at this screen location
        dex                     
        bne     gnrtn2          ;next loop
        jsr     delay2
        lda     #$60
        sta     ($fb),y         ;at this screen location
        jmp     linefix       
dcln2   dec     $fc             ;decrease high bit for screen location
        sec
        jmp     gnrtn3

decline dec     $fc             ;decrease high bit for screen location
        sec
        jmp     gnrtn

delay   lda     $d012
        cmp     #$ff
        bne     delay
        rts

delay2  ldx     #20
dlp     lda     $d012
        cmp     #$ff
        bne     dlp
        dex
        bne     dlp
        rts

delayx  lda     $d012
        cmp     #$ff
        bne     delayx
        dex
        bne     delayx
        rts

summary ldx #0
@write  lda endday,x                      ;adds words
        sta $0437,x
        inx
        cpx #10
        bne @write

dayttl  
        ldx #0
@write  lda total,x                      ;adds words
        sta $05c2,x
        inx
        cpx #21
        bne @write
        conv2dec        Price,#0,$05F2                  ;update price count

summath 
        conv2dec        SaleCount,SaleCountHi,$05EA     ;update sale count
        conv2dec        CashCount,CashCountHi,$05FA     ;update inline count
        lda SaleCountHi
        cmp #0
        bne @mathit
        lda SaleCount
        cmp #0
        bne @mathit
        jmp waititup
@mathit
        16bitadd        CashCount,CashCountHi,Price
        16bitsub        SaleCount,SaleCountHi,#1
        ldx #$ff
        jsr delayx
        jmp summath
        
        

waititup
        inc $0400
        jmp waititup
